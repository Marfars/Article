# 文字的测量

## Paint

- strokeCap：线的两端形状

- textSize: 设置字体大小

- typeface：设置字体类型，如微软雅黑

- isFakeBoldText:设置是否为粗体

- textAlign:设置放置位置

### 绘制时为什么不使用sp使用dp需要钻研下

## 文字绘制的基准线————文字垂直居中的绘制

当我们使用drawText的时候，设置的点是绘制的起点，如果不设置水平对齐的方式，它就会**默认居左**从左下角开始绘制；垂直方向上是默认从**BaseLine**向上绘制

### BaseLine的作用

- 用于规定字体绘制的下基线，水平线

### 如何消除基线导致的偏移（如何获取）

#### （静态文字）使用paint的getTextBounds方法可以获取字体边界，第四个参数传入的Rect是用于存储边界值，将来可以直接使用此边界值，如果我们想要垂直方向上的中心，可以计算出下述rect中的顶部至底部的中心值，就是应该在竖直方向上的偏移，例如

```Java
// 用于存储大小范围
val rect = Rect()
// 绘制的文本
val text = "文本"
// 获取文本绘制时的范围
paint.getTextBounds(text, 0, text.length, rect)
// 使用rect的一些方法就可以计算出偏移
```

#### （动态文字）如果绘制的是动态文字（如进度），使用顶部至底部的中心值就会导致文字上下跳动，那这个时候我们就需要找一个比较稳定的上基线和下基线，以此来计算中心值，在此之前要先了解下文字绘制的五条线

### 五条基准线

- BaseLine

- top: 文字整体的顶部最大值（与具体绘制的字有关，例如p和b的top值就是不一样的）

- ascent：文字核心部分的顶（与具体哪个字无关，和字体有关，例如p和b的ascent值就是一样的）

- descent：文字核心部分的底（同ascent）

- bottom：文字整体的底部最大值（同top）

### 获取动态文字的中心值

了解了五条线的含义，很明显我们需要计算的是对某个字体的中心值偏移，即(descent + ascent) * 0.5f，具体代码如下

```Java
private val center = 
(paint.fontMetrics.ascent + paint.fontMetrics.descent) * 0.5f

```

- 缺点：如果静态文字也使用这种方式就会导致绘制a或p这样字母的时候看起来偏下，因为他的实际中心值会比字体中心偏移值靠上一点，整体看起来就会靠下.**简而言之，字体中心值不准，所以在动态文字中可以作为尽可能中心的值，但是静态要求尽可能准就要使用文字中心值**

## 文字绘制的另一难题

### 利用paint.getTextBounds方法获取到的文字获取边界，可以计算出文件绘制时的前面空缺和顶部空缺

## 多行绘制

### StaticLayout

- 纯文本绘制时可以使用此方法

### paint.breakText

此方法可以传入一个绘制的最大宽度，然后传入绘制的文本内容，并传入绘制的文本起始值，返回一个能绘制的最大数目

```Java
/**
* TEXT是传入的文字
* start是绘制文字的起点
* TEXT.length是绘制文字的终点
* maxWith为绘制的最大宽度
* paint会按照可以绘制的最大宽度返回绘制的最大字数，就是count
**/
val count = paint.breakText(TEXT, start, TEXT.length, true, maxWidth, measureArray)

```
