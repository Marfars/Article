# 布局过程的完全解析

## 布局过程

### 作用：为绘制和触摸范围做支持

- 绘制：知道往哪里绘制

- 触摸反馈：知道用户点的是哪里

### 实际意义：减少写布局文件的难度

## 流程

### 从整体看分两个流程

#### 测量流程

- 从根View递归调用每一级子View的measure方法，对他们进行测量

#### 布局流程

- 从根View递归调用每一级子View的layout方法，把测量结果得出的子View的位置和尺寸传给子View，子View保存

#### 为什么要分两个流程？

- 测量流程比较复杂，可能要去测量多个子View之后才能得到他们的位置和尺寸，而且有的子View可能要测量多次

### 从个体看，对于每个View

#### 运行前，开发者在XML文件里写入对View的布局要求layout_xxx

#### 父View在自己的onMeasure中，根据开发者在XML中写的对子View的要求，和自己的可用空间，得出对子View的具体尺寸要求

#### 子View在自己的onMeasure中，根据父View的要求以及自己的特性算出自己的期望尺寸

- 如果剩余空间不足以满足子View的要求，会以开发者的要求来绘制

- 如果是ViewGroup，还会在这里调用每个子View的measure进行测量

- 开发者对View绘制的要求很重要，那为什么是交给父View而不是子View呢？

  - 因为开发者的要求不一定都是精准的要求，也可能是match_parent或者wrap_content这种模糊要求。
  
  - 可能不止有尺寸要求，还有位置要求。这时候放在第一行和第二行就是不一样的，比如linearLayout的weight属性

#### 父View在子View计算出期望尺寸后，得出子View的实际尺寸和位置

#### 子View在自己的layout方法中，将父View传进来的自己的实际尺寸和位置保存

- 如果是ViewGroup，还会在onLayout里调用每个子View的layout把它们的尺寸位置传给他们